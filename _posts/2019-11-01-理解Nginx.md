---
title: "理解Nginx"

url: "https://wsk1103.github.io/"

tags:
  - 架构
  - Nginx
---

## 1. nginx是什么

[Nginx官网说明](https://nginx.org/en/)  
nginx [engine x] is an HTTP and reverse proxy server, a mail proxy server, and a generic TCP/UDP proxy server, originally written by Igor Sysoev.  
nginx [engine x]是HTTP和反向代理服务器，邮件代理服务器和通用TCP / UDP代理服务器，最初由Igor Sysoev编写。

## 2. 安装
基于centOS7 安装

直接一键安装
```
yum -y install nginx
```
ps:可能出现的问题

```
没有可用软件包 nginx。
错误：无须任何处理
```
这个时候是因为 **nginx** 在 **yum** 里面是没有的，需要使用到 **epel源** ，也就是安装 **epel-release** 。

```
yum install epel-release
```
安装成功后再安装 **nginx**

## 3. 文件说明
安装完成后，配置文件 nginx.conf 位于 /etc/nginx/nginx.conf

```
[root@wsk1103 yum.repos.d]# cd /etc/nginx/
[root@wsk1103 nginx]# ls
conf.d                  koi-utf             scgi_params
default.d               koi-win             scgi_params.default
fastcgi.conf            mime.types          uwsgi_params
fastcgi.conf.default    mime.types.default  uwsgi_params.default
fastcgi_params          nginx.conf          win-utf
fastcgi_params.default  nginx.conf.default
```
##### 1. nginx.conf，nginx.conf.default
主要的配置文件

##### 2. conf.d，default.d
空的文件夹

##### 3. fastcgi.conf， fastcgi.conf.default，fastcgi_params，fastcgi_params.default
[fastcgi例子](https://www.nginx.com/resources/wiki/start/topics/examples/fastcgiexample/)    
nginx配置Fastcgi解析时会调用fastcgi_params配置文件来传递服务器变量，这样CGI中可以获取到这些变量的值。  
这允许我们使单个的FCGI配置尽可能的简单。我们可以根据实际的路径替换 **SCRIPT_FILENAME** 和 **DOCUMENT_ROOT** 里面的 **$document_root** ， **$ document_root** 变量是硬编码的，可能无法随着我们的安装（通常会报“找不到脚本”的错误）。如果要使用NGINX +虚拟主机+ PHP，我们应该省略 **SCRIPT_NAME** 变量，以便 **PHP** 选择正确的 **DOCUMENT_ROOT**

##### 4. koi-utf，koi-win，win-utf
这三个文件都是与编码转换映射文件，用于在输出内容到客户端时，将一种编码转换到另一种编码。

##### 5. uwsgi_params,scgi_params
与 **fastcgi_params** 一样，传递哪些服务器变量，只有前缀不一样，以 **uwsgi_param** 开始而非 **fastcgi_param** 。

##### 6. mime.types，mime.types.default
文件扩展名与文件类型映射表，nginx根据映射关系，设置http请求响应头的Content-Type值。当在映射表找不到时，使用nginx.conf中default-type指定的默认值。  
默认配置中的指定的default-type为application/octet-stream。
```
    include             /etc/nginx/mime.types;
    default_type        application/octet-stream;
```

### 访问日志路径 和 错误日志路径

```
[root@wsk1103 wsk]# cd /var/log/nginx/
```
里面有日志 access.log(接收日志) 和 error.log（错误处理日志）

## 4.启动Nginx

```
[root@wsk1103 nginx]# systemctl start nginx
```
默认端口为 **80** ，打开浏览器，访问 **localhost**，出现 **NGINX** 页面表示启动成功

#### 关于 nginx 命令


```
systemctl enable nginx         开机启动nginx服务
systemctl disable nginx         禁止开机启动nginx服务
systemctl is-enable nginx      查询是否开机启动nginx服务
systemctl start nginx              启动nginx服务
systemctl stop nginx              停止nginx服务
systemctl reload nginx            重新加载nginx服务
systemctl restart nginx            重启nginx服务
systemctl status nginx             查看nginx服务状态
```

## 3. 正向代理和反向代理
#### 1. 反向代理
指服务器以代理服务器的形式，将接受到的网络请求转发到内部的其他服务器上，并从该内部服务器将响应结果返回给网络请求，这个时候请求者只知道代理服务器的IP地址，而不知道真正的服务器地址，防止真正的服务器受到不必要的攻击。

![image](https://raw.githubusercontent.com/wsk1103/images/master/nginx/1.png)

##### 反向代理的好处
- 保护真正的后台服务器，使黑客不知道真正的服务器的IP地址。
- 通过缓存静态资源，加速Web请求。
- 实现负载均衡。

#### 2. 正向代理
正向代理服务器，一个位于客户端和后台服务器之间的服务器，为了从后台服务器取得内容，客户端向代理发送一个请求并指定目标(后台服务器)，然后代理向后台服务器转交请求并将获得的内容返回给客户端。

![image](https://raw.githubusercontent.com/wsk1103/images/master/nginx/2.png)
## 7. Nginx 配置
## 8. nginx 配置文件实例
## 4. Nginx的Master-Worker模式
## 5. Nginx实现热部署
## 6. Nginx如何做到高并发下的高效处理

## 9. Keepalived+Nginx实现高可用
